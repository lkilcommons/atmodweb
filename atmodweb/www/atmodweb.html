	<!DOCTYPE html>
	<html>
   <head>
	<meta charset="utf-8" />
	<link href="www/atmodweb.css" rel="stylesheet" type="text/css">
	<title>AtModWeb</title>
	</head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script>
		/*
			The whole ajax example
			$.ajax({
			// The URL for the request
			url: "post.php",
			
			// The data to send (will be converted to a query string)
			data: {
			id: 123
			},
			
			// Whether this is a POST or GET request
			type: "GET",
			
			// The type of data we expect back
			dataType : "json",
			
			// Code to run if the request succeeds;
			// the response is passed to the function
			success: function( json ) {
			$( "<h1>" ).text( json.title ).appendTo( "body" );
			$( "<div class=\"content\">").html( json.html ).appendTo( "body" );
			},
			
			// Code to run if the request fails; the raw request and
			// status codes are passed to the function
			error: function( xhr, status, errorThrown ) {
			alert( "Sorry, there was a problem!" );
			console.log( "Error: " + errorThrown );
			console.log( "Status: " + status );
			console.dir( xhr );
			},
			
			// Code to run regardless of success or failure
			complete: function( xhr, status ) {
			alert( "The request is complete!" );
			}
			
			});
		*/


		$(document).ready(function(){
			$plottype_sel = $("#plottype_select");
			
			$xobj = {'sel':$("#xvar_select"),'bounds':$("#xbounds"),'log':$("#xlog")}
			$yobj = {'sel':$("#yvar_select"),'bounds':$("#ybounds"),'log':$("#ylog")}
			$zobj = {'sel':$("#zvar_select"),'bounds':$("#zbounds"),'log':$("#zlog")}
			
			$xvar_sel = $("#xvar_select");
			$yvar_sel = $("#yvar_select");
			$zvar_sel = $("#zvar_select");
			$all_var_sel = $("#xvar_select, #yvar_select, #zvar_select") 
			$all_var_log = $("#xlog,#ylog,#zlog")
			$all_var_bounds = $("#xbounds,#ybounds,#zbounds")
			//Set up the functions to change controlstates

			//First we must set up the handler for changes on the plottype select

			//Init stuff - set debug options - temporary stuff
			$("#debugpanel").addClass("debug_on").addClass("initialize_me")
			$("#dynamicdriverdiv").addClass("initialize_me")

			//-------------------------------------------------------
			//Functions which preform repeated tasks
			//-------------------------------------------------------
			//Deal with padding zero values so things look sensible because...javascript
			$pad = function (str, max) {
 				 str = str.toString();
  				return str.length < max ? $pad("0" + str, max) : str;
			}

			//Checks if any of the selects have Latitude,Longitude or Altitude,
			//and hides the associated control if they do (since it's then an independant variable)
			$hidePosIfNeeded = function () {
				var def = $.Deferred()

				var xvar = $xvar_sel.val()
				var yvar = $yvar_sel.val()
				var zvar = $zvar_sel.val()
				if ( $.isArray(xvar) ){ xvar = xvar[0] }
				if ( $.isArray(yvar) ){ yvar = yvar[0] }
				if ( $.isArray(zvar) ){ zvar = zvar[0] }
				
				var lat_in = $.inArray("Latitude",[xvar,yvar,zvar]) != -1
				var lon_in = $.inArray("Longitude",[xvar,yvar,zvar])  != -1
				var alt_in = $.inArray("Altitude",[xvar,yvar,zvar]) != -1
				console.log([xvar,yvar,zvar])
				console.log([lat_in,lon_in,alt_in])
				$("#latinputlbl").hide()
				$("#latinputlbl").hide()

				if (lat_in) { $("#latinputlbl").hide() } else { $("#latinputlbl").show() } 
				if (lon_in) { $("#loninputlbl").hide() } else { $("#loninputlbl").show() }
				if (alt_in) { $("#altinputlbl").hide() } else { $("#altinputlbl").show() }

				def.resolve()
				return def.promise()
			} 

			//set all var selects to their value in the controlstate
			$init_all_sel = function () {
				//When we're sure we're initialized, set the option to the currently selected variable in the controlstate
					var allset = $.Deferred()

					var xname = $xvar_sel.attr("name")
					var xvar_sel_set = $.ajax({url: "uihandler",data: {"statevar":xname},type: "GET", 
						success: function (json) {
							$xvar_sel.val(json[xname])
							console.log("Init x select to"+json[xname])
						}
					})

					var yname = $yvar_sel.attr("name")
					var yvar_sel_set = $.ajax({url: "uihandler",data: {"statevar":yname},type: "GET", 
						success: function (json) {
							$yvar_sel.val(json[yname])
							console.log("Init y select to"+json[yname])
						}
					})

					var zname = $zvar_sel.attr("name")
					var zvar_sel_set = $.ajax({url: "uihandler",data: {"statevar":zname},type: "GET", 
						success: function (json) {
							$zvar_sel.val(json[zname])
							console.log("Init z select to"+json[zname])
						}
					})
					$.when([xvar_sel_set,yvar_sel_set,zvar_sel_set]).then(allset.resolve())
					return allset.promise()
			}

			$format_caption = function (csstring) {
				//Turns a comma-seperated string into a ul
				console.log(csstring)
				var values = csstring.split('|') //split on pipes incase there are any commas in data
				var theul = '<ul ID="captionlist" class="captionlist">' 
				for (v in values) {
					theul=theul+'<li class="captionlist">' + values[v] + '</li>'
				}
				theul=theul+'</ul>'
				console.log(theul)
     			return theul
			}
			
			//-----------------------------------------------------
			//Handlers which initialize or update UI control values
			//-----------------------------------------------------

			$plottype_sel.on("focus",function(e) {
				var myname = $(e.target).attr("name")

				//Use the name attr of the input to decide what field of the datetime object we will get
				
				var doneprocessing = $.ajax({url: "/uihandler",data: {"statevar":myname},type: "GET",dataType:"json",
					success: function(json) {
						console.log(json)
						$(e.target).val(json[myname])
						console.log("In plottype focus, val is", $(e.target).val())
					}
				})

				return doneprocessing
				//e.preventDefault()
			});

			

			//--X,Y and Z Variable Selects 
			$all_var_sel.on("focus",function( e ) {
				//Initialize it if it asks for it
				var myname = $(e.target).attr("name")
				var initializing = $.Deferred()

				if ( $(e.target).hasClass("initialize_me") ){
					//Get the list of valid options we can use from the backend (from the session)
					var spawning_options = $.ajax({url: "/uihandler",data: {"statevar":myname+"_options"},type: "GET",
						success: function( json ) {
							//Populate the list
							$("option",e.target).remove(); //All options under this
							console.log(json)
							$.each(json[myname+"_options"], function(key, value) {
								//Set the option value to the key, and the html to the value
								$(e.target).append($('<option>', { value : key }).text(value))
							});
													
						}
					});
				//Remove the initilization tag from the select
				$(e.target).removeClass("initialize_me")
				//Set the initializing deferred to resolved once we've 

				$.when(spawning_options).then($init_all_sel()).then(initializing.resolve())
					
				} else {
					initializing.resolve()
				}
				
				return initializing.promise()
				//e.preventDefault()
			});

			//--X, Y, and Z Limit Inputs
			$all_var_bounds.on("focus",function(e) {
				var myname = $(e.target).attr("name")
				$.ajax({url: "/uihandler",data: {"statevar":myname},type: "GET",
					success: function(json){
						var newbounds = json[myname]
						$(e.target).val(newbounds[0].toFixed(2)+","+newbounds[1].toFixed(2))
					}
				});

				//e.preventDefault()
			});

			//--Date Entry Inputs
			$(".dateinput").on("focus",function(e) {
				var myname = $(e.target).attr("name")
				//Use the name attr of the input to decide what field of the datetime object we will get
				
				var dtpadding = {"year":4,"month":2,"day":2,"hour":2,"minute":2}

				$.ajax({url: "/uihandler",data: {"statevar":"datetime","subfield":myname},type: "GET",dataType:"json",
					success: function(json) {
						console.log(json)

						$(e.target).val($pad(json["datetime"],dtpadding[myname]))
					}
				})

				//e.preventDefault()
			});

			//--Latitude, Longitude, Altitude Input Elements
			$(".positioninput").on("focus",function(e) {
				var myname = $(e.target).attr("name")
				//Use the name attr of the input to decide what field of the datetime object we will get
				
				$.ajax({url: "/uihandler",data: {"statevar":myname},type: "GET",dataType:"json",
					success: function(json) {
						console.log(json)
						$(e.target).val(String(json[myname]))
					}
				})

				//e.preventDefault()
			});

			//--Driver Entry Inputs Are Dynamically Created
			//--so must be rebound when they are created
			//--look for them bound to the main document click handler below

			

			//-------------------------------------------------------------------
			//Handlers which put new values to backend controlstate (on "change")
			//-------------------------------------------------------------------

			//--The Type of Plot Chooser Select
			$plottype_sel.on("change",function(e) {
				var selection = $(e.target).val();
				var defrd = $.Deferred() //This is so we can check if the callback finished
				//Tell the backend that we have a change to the plotvar
				//{"statevar":"plottype","newval":selection}
				console.log("In plottype change, val is", selection)

				var plottype_changed = $.ajax({url: "/uihandler",data: {"statevar":"plottype","newval":selection},type: "PUT"})

				if (selection == "line") {
					//If we are plotting a line, then don"t bother showing the color variable select
					
					//Trigger the xvar, yvar to populate
					
					$xvar_sel.addClass("initialize_me")
					$xvar_sel.attr("multiple","true")
					$("xlog_label").show()
					
					$yvar_sel.addClass("initialize_me")
					$yvar_sel.attr("multiple","true")
					$("xlog_label").show()
					
					$(".zvar").hide();
					$zvar_sel.removeAttr("multiple")
				}

				if (selection == "pcolor")
				{
					$(".zvar").show()
					
					$xvar_sel.addClass("initialize_me")
					$xvar_sel.removeAttr("multiple")
					$("xlog_label").hide()
					
					$yvar_sel.addClass("initialize_me")
					$yvar_sel.removeAttr("multiple")
					$("ylog_label").hide()

					$zvar_sel.addClass("initialize_me")
					$zvar_sel.removeAttr("multiple")
					$("zlog_label").show()

				}

				if (selection == "map")
				{
					$(".zvar").show()
					
					$xvar_sel.addClass("initialize_me")
					$xvar_sel.removeAttr("multiple")
					$("xlog_label").hide()
					
					$yvar_sel.addClass("initialize_me")
					$yvar_sel.removeAttr("multiple")
					$("ylog_label").hide()

					$zvar_sel.addClass("initialize_me")
					$zvar_sel.removeAttr("multiple")
					$("zlog_label").show()
						
				}
				
				
				$.when(plottype_changed).then(function (data) {
					console.log("Triggering focus from plottype change")
					var xvar_done = $xvar_sel.triggerHandler("focus")
					var yvar_done = $yvar_sel.triggerHandler("focus")
					var zvar_done = $zvar_sel.triggerHandler("focus")
					$.when(xvar_done,yvar_done,zvar_done).then(defrd.resolve());
				})
			
				return defrd.promise() //Return a Deferred so we can see if the callback finished
			});

			//--Model Select Dropdown
			$("#model_select").on("change",function(e) {
				var myname = $(e.target).attr("name")
				var selection = $(e.target).val()
				$.ajax({url: "/uihandler",data: {"statevar":myname,"newval":selection},type: "PUT",
							success: function (ret) {
								var refreshed = $.ajax({url: "/uihandler",data: {"posttype":"refreshnow"},type: "POST"})
								refreshed.done(function (data) {
									$.ajax({url: "/uihandler",data: {"posttype":"refreshmodeloptions"},type: "POST"})
									$("#dynamicdriverdiv").addClass("initialize_me") // Reinit drivers dropdown
								});
							}	
				
						})
			});

			//Hide it for now because it doesn't work
			$("#model_select").hide()

			
			//--X,Y,Z Variable Select Dropdowns 
			$all_var_sel.on("change",function(e) {
				//We use the name attribute to know what controlstate variable the select sets
				var myname = $(e.target).attr("name")
				var selection = $(e.target).val()
				var statevar = String(myname.charAt(0)+"multi")
				

				//Handles formating the data for PUT ajax calls
				if ( $.isArray(selection) && selection.length > 1) {
					console.log(statevar)
					var multi_updated = $.ajax({url: "/uihandler",data: {"statevar":statevar,"newval":true},type: "PUT"})
				} else if ( $.isArray(selection) && selection.length == 1 ) {
					selection = selection[0]
					var multi_updated = $.ajax({url: "/uihandler",data: {"statevar":statevar,"newval":false},type: "PUT"})
					
				} else {
					var multi_updated = $.ajax({url: "/uihandler",data: {"statevar":statevar,"newval":false},type: "PUT"}) 
				}
				
				
				//Have to do something odd to pass an array to cherrypy with jquery, use 'traditional' param parsing mode
				multi_updated.done( function(data) {
					console.log(multi_updated.state())
					var ajax_done = $.ajax({url: "/uihandler",data: $.param({"statevar":myname,"newval":selection}, true),type: "PUT",
							success: function (thedata) {
								//Make sure the bounds are up to date
								console.log("Triggering all bounds to focus after variable change")
								$all_var_bounds.trigger("focus")
								$hidePosIfNeeded()
								$(".positioninput").trigger("focus")
							}
						})
					});


				
			});

			//--X, Y and Z Log Checkboxes
			$all_var_log.on("change",function(e) {
				var myname = $(e.target).attr("name")
				var newval = $(e.target).prop("checked")
				$.ajax({url: "/uihandler",data: {"statevar":myname,"newval":newval},type: "PUT"})
				
			});

			//--X, Y, and Z Bounds Inputs
			$all_var_bounds.on("change",function(e) {
				var myname = $(e.target).attr("name")
				var newval = $(e.target).val()
				var temp = newval.split(',') //Try to split up by commas
				
				if ( temp.length != 2 ) {
					alert("Bounds inputs must have form lowerbound,upperbound")
				} else {
					//Have to do something odd to pass an array to cherrypy with jquery, use 'traditional' param parsing mode
					$.ajax({url: "/uihandler",data: $.param({"statevar":myname,"newval":temp},true),type: "PUT"})
				}
			});

			//--Date Change Inputs
			$(".dateinput").on("change",function(e) {
				//Use the name attr of the input to decide what field of the datetime object we will set
				var myname = $(e.target).attr("name")
				var newval = $(e.target).val()
				//{"statevar":"datetime","newval":{myname : parseInt(newval)}}
				var ajax_done = $.ajax({url: "/uihandler",data: {"statevar":"datetime","subfield":myname,"newval":parseInt(newval)},type: "PUT"})
				$.when(ajax_done).then($("#plotbutton").trigger("click"))
			});

			//--Position Change Inputs
			$(".positioninput").on("change",function(e) {
				//Use the name attr of the input to decide what field of the datetime object we will set
				var myname = $(e.target).attr("name")
				var newval = $(e.target).val()
				//{"statevar":"datetime","newval":{myname : parseInt(newval)}}
				var ajax_done = $.ajax({url: "/uihandler",data: {"statevar":myname,"newval":newval},type: "PUT"})
				var autoscale_done = $.ajax({url: "/uihandler",data: {"posttype":"autoscale"},type: "POST"})
				$.when([ajax_done,autoscale_done]).then($("#plotbutton").trigger("click"))
			});

			
			//---Handle clicking the plot button---
			$('#plotbutton').on('click',function(){
				//Tell the backend to work through any UI changes and replot
				var plotting_done = $.Deferred()

				$("#plotimg").attr("src","/www/loading.gif")

				var refreshing = $.ajax({url: "/uihandler", data: {"posttype":"refreshnow"},type: "POST",
					error: function( err ) {
						alert("Failed to refresh plot!")
					}

				})
				//Tell the backend to save the plot and return the url to the image
				refreshing.done(function (thedata) { 
					$.ajax({url: "/uihandler", data: {"posttype":"replotnow"},type: "POST",dataType: "json",
					success: function( json ) {
							$("#plotimg").attr("src",json["src"]);    
							$("#plotimg_cap").html($format_caption(json["cap"]))
							$("#dynamicdriverdiv").addClass('initialize_me')
						}
					})
					//Make sure position and date are up to date
					$(".dateinput,.positioninput").trigger("focus")	
				})
				//Update the plot history
				$.when(refreshing).then(function (thedata) {
	 				var loading_history = $.ajax({url: "/uihandler", data: {"statevar":"recentplots"},type: "GET",
						success: function (json) {
	 						$recent_files = json["recentplots"]
	 					}
	 				})
	 				var loading_history_caps = $.ajax({url: "/uihandler", data: {"statevar":"recentcaptions"},type: "GET",
	 					success: function (json) {
	 						$recent_captions = json["recentcaptions"]
	 					}
	 				})
	 			}).then(function (thedata) {
	 				$("#dynamicdriverdiv").addClass("initialize_me")
				 	return $("#dynamicdriverdiv").triggerHandler("click")
	 			}).then(plotting_done.resolve())
			});

			//Drivers inputs that are Ajaxed in
			$("#dynamicdriverdiv").on("click", function (e) {
				var all_done = $.Deferred()
				if ( $("#dynamicdriverdiv").hasClass('initialize_me') ) {
					//make sure the controlstate is up to date. Strictly this isn't nessecary
					//var refreshing = $.ajax({url: "/uihandler", data: {"posttype":"refreshmodeloptions"},type: "POST"})
					$(".dynamicinput").remove()
					var getting_drivers = $.ajax({url: "/uihandler",data: {"statevar":"drivers"},type:"GET",
						success: function(json){
							$.each(json["drivers"], function(key,value) {
								var newinput = $("<input type='text' class='dynamicinput' size='8'>").val(value).attr("name",key).attr("ID",'dynamicinput'+key)
								var newlabel = $("<label class='dynamicinput'>").text(key+":")
								$("#dynamicdriverdiv").append(newlabel.append(newinput)) 
								$("#dynamicdriverdiv").append($("<br class='dynamicinput'>"))
								//Bind an event listener on creation
								newinput.on("change",function(e){
									var myname = $(e.target).attr("name")
									var textval = $(e.target).val()
									console.log("Dynamic Driver Change")
									var ajax_done = $.ajax({url: "/uihandler",data: {"statevar":"drivers","subfield":myname,"newval":textval},type: "PUT"})
									return ajax_done
								});
								newinput.on("focus",function(e){
									var myname = $(e.target).attr("name")
									var textval = $(e.target).val()
									console.log("Dynamic Driver Focus")
									var ajax_done = $.ajax({url: "/uihandler",data: {"statevar":"drivers","subfield":myname},type: "GET",
										success: function (json) {
											$(e.target).val(String(json["drivers"]))
										}
									})
									return ajax_done
								});
							}) //Loop on all the contents of the returned "drivers" object	
						} //success function
					});
					$("#dynamicdriverdiv").removeClass("initialize_me")
					$.when(getting_drivers).then(all_done.resolve())
				} else {
					all_done.resolve()
				}
				return all_done
			})

			//Put a loading image in the plot
			$("#capdiv").slideUp()
			$("#plotimg").attr("src","/www/loading.gif")


			//Signal to the uihandler that we're ready to sync up the contolstate
			//this propagates any changes that happened to the ControlState dict
			//on the backend to the CherryPy session variable 
			var synching = $.ajax({url: "/uihandler", data: {"posttype":"uiready"},type: "POST"})
			//synching is a 'Promise'...a read-only Deferred

			//--Set initial plot
			synching.done(function (thedata) {
				var plotting_done = $.ajax({url: "/uihandler", data: {"posttype":"replotnow"},type: "POST",dataType: "json",
					success: function( json ) {
						
						$("#plotimg").attr("src",json["src"]);    
						$("#plotimg_cap").html($format_caption(json["cap"]))
						//These must be done in the right order, so they pass back a 
						//Deferred so they can be used with when and then
						//They must be done in order because they tell the x,y,and z
						//selectors to populate and set up the proper visibility for those 
						//elements based on the plottype that is default in the controlstate
						
						$.when($plottype_sel.triggerHandler("focus")).then(
							function () {
								console.log("Done with focus")
								$.when($plottype_sel.triggerHandler("change")).then(
								function (data) {
									console.log("Done with change")
									var xdone = $xvar_sel.triggerHandler("focus")
									var ydone = $yvar_sel.triggerHandler("focus")
									var zdone = $zvar_sel.triggerHandler("focus")
									$.when(xdone,ydone,zdone).then(function () {
										$.when($init_all_sel()).always($hidePosIfNeeded())
									})
									$('.positioninput,.dateinput').trigger("focus")
								}).then($all_var_bounds.trigger("focus"))
							});
						
						$("#dynamicdriverdiv").addClass("initialize_me")
						$("#dynamicdriverdiv").trigger("click")

						}
					})
			});



			//--This is a hack. It forces the session to restart.
			//$.ajax({url: "/uihandler", data: {"statevar":"debugreinit"},type: "POST"})
 			
			//Handle clicking the previous or next button
			$recent_index = 1
			//Init the recent_files and recent_captions globals here
			var loading_history = $.ajax({url: "/uihandler", data: {"statevar":"recentplots"},type: "GET",
					success: function (json) {
 						$recent_files = json["recentplots"]
 					}
 				})
			var loading_history_caps = $.ajax({url: "/uihandler", data: {"statevar":"recentcaptions"},type: "GET",
				success: function (json) {
					$recent_captions = json["recentcaptions"]
				}
			})

 			$("#previous_button,#next_button").on("click",function(e) {
 				var caller_id = $(e.target).attr("ID")
 				console.log(caller_id)

				if ( caller_id == "previous_button" ) {
					if ( $recent_index < $recent_files.length ) {
						$recent_index = $recent_index + 1
						$("#plotimg").attr("src",$recent_files[$recent_files.length-$recent_index]);
						$("#plotimg_cap").html($format_caption($recent_captions[$recent_captions.length-$recent_index]));
						$("#caplabel").text('Plot #'+String($recent_captions.length-$recent_index+1)+'/'+String($recent_captions.length))
						$('#capdiv').slideDown()
					} 
				}
				else if ( caller_id == "next_button" ) {
					if ( $recent_index > 1 ) {
						$recent_index = $recent_index - 1
						//Change the plot image
						$("#plotimg").attr("src",$recent_files[$recent_files.length-$recent_index]);
						$("#plotimg_cap").html($format_caption($recent_captions[$recent_captions.length-$recent_index]));
						$("#caplabel").text('Plot #'+String($recent_captions.length-$recent_index+1)+'/'+String($recent_captions.length))
						$('#capdiv').slideDown()
					} 
				}
				
				
			})
			//Some cute little animation of the plot details
			$("#plotimg").on('click', function() {
    			$('#capdiv').slideToggle()
			})

			$("#capdiv").on('click', function() {
    			$('#capdiv').slideUp()
			})

			//Bind a click handler to the panic button
			$("#panic").on("click",function(e) {
				$.ajax({url: "/uihandler", data: {"posttype":"debugreinit"},type: "POST"})
			});
				
			//Bind a click handler to the debug panel to hide it on click, or initialize it if nessecary
			$("#debugpanel").on('click',function() {
				if ( $("#debugpanel").hasClass("debug_on") ) {
					$("#debugpanel").removeClass("debug_on")
					$("#debug_table,#panic").slideUp()
				} else {
					$("#debugpanel").addClass("debug_on")
					$("#debug_table,#panic").slideDown()
				}
				if ( $("#debugpanel").hasClass("debug_on") ) {
					$.ajax({url: "/uihandler",data: {"statevar":"controlstate"},type:"GET",
						success: function(json) {
							if ( $("#debugpanel").hasClass("initialize_me") ){
								$("#debugpanel").append($("<table>").attr("ID","debug_table")).addClass('debug_table')
								$("#debugpanel").removeClass("initialize_me")
							}

							$(".debug_table_el").remove() //Clear old
							$.each(json["controlstate"],function(key,value) {
								//console.log(value)
								$("#debug_table").prepend(
									$("<tr>").append(
										$("<th>").append($("<strong>").text(key)).addClass('debug_table_el').addClass('debug'+key),
										$("<td>").html($.parseHTML(value)).addClass('debug_table_el').addClass('debug'+key)
									)
								).addClass('debug_table')
							});
						}
					});
				} else {
					$("#debug_table,#panic").hide()
				}
			}); 

			//Force finish of init, implement hackery
			$.when(synching).then($hidePosIfNeeded())
		});


		$(document).on("click", function (e){
			//This is a hack to get the position controls to hide properly. I have no idea why it's not 
			//working with deferreds as I had hoped. Arg.
			
		});
	</script>
	<body>
		<div ID = "titlepanel" class="panel">
			<h1 class="h1title">Atmospheric Model Web Explorer (AtModWeb)</h1>
		</div>
		<div ID="wrap">
			<div ID="leftcolumn">
				
				<div ID="locationpanel" class="panel">
				<h2 class="h2title">Location</h2>
					<label ID='latinputlbl'>Latitude:<input ID='latinput' type="text" name="lat" size="8" value="" class="positioninput"></label><br>
					<label ID='loninputlbl'>Longitude:<input ID='loninput' type="text" name="lon" size="8" value="" class="positioninput"></label><br>
					<label ID='altinputlbl'>Altitude:<input ID='altinput' type="text" name="alt" size="8" value="" class="positioninput"></label>
				</div>

				<div ID="datepanel" class="panel">
					<h2 class="h2title">(Solar Wind) Driver Lookup</h2>
					<p>Y-M-D H:M</p>
					<input type="text" name="year" value="2000" size="4" class="dateinput"><span>-</span>
					<input type="text" name="month" value="06" size="2" class="dateinput"><span>-</span>
					<input type="text" name="day" value="21" size="2" class="dateinput"><span>  </span>
					<input type="text" name="hour" value="12" size="2" class="dateinput"><span>:</span>
					<input type="text" name="minute" value="00" size="2" class="dateinput">				
				</div>
				
				
				<div ID="manualpanel" class="panel">
					<h2 class="h2title">Manual Driver Entry</h2>
					<div ID="dynamicdriverdiv" class="initialize_me">

					</div>
				</div>

				<div ID="debugpanel" class="panel">
					
					<h2 class="h2title">Debugging</h2>
					<button ID="panic">Panic Button</button>

				</div>

			</div>
			
			<div ID="rightcolumn">
				<div ID="mainpanel" class="panel">
					<h2 class="h2title">Plot Options</h2>
					
					<select ID="model_select" name="modelname" class="model">
						<option value="msis">NRLMSISE00</option>
						<option value="hwm">HWM07</option>
					</select>

					<select ID="plottype_select" name="plottype" class="plottype">
						<option value="null">Choose a plot type...</option>
						<option value="line">Line Plot</option>
						<option value="pcolor">Heatmap/Pseudocolor</option>
						<option value="map">Map</option>
					</select>

					<button ID="plotbutton">replot!</button>

					<div ID="xvar_div" class="panel xvar">
						<select ID="xvar_select" name="xvar" multiple="true" class="var xvar">
								<option value="null">Choose a X variable...</option>
						</select>

						<label ID="xlog_label" class="xvar">Logscale X:					
							<input ID="xlog" type="checkbox" name="xlog" class="var xvar log">
						</label>

						<label ID="xbounds_label" class="xvar">X-axis Limits:					
							<input ID="xbounds" type="text" name="xbounds" class="var xvar bounds">
						</label>
					</div>
					
					<div ID="yvar_div" class="panel yvar">

						<select ID="yvar_select" name="yvar" multiple="true" class="var yvar">
							<option value="null">Choose a Y variable...</option>
						</select>
						
						<label ID="ylog_label" class="yvar">Logscale Y:				
							<input ID="ylog" type="checkbox" name="ylog" class="var yvar log">
						</label>

						<label ID="ybounds_label" class="yvar">Y-axis Limits:					
							<input ID="ybounds" type="text" name="ybounds" class="var yvar bounds">
						</label>
					</div>
					
					<div ID="zvar_div" class="panel zvar">

						<select ID="zvar_select" name="zvar" multiple="true" class="var zvar">
							<option value="null">Choose a color variable...</option>
						</select>

						<label ID="zvar_label" class="zvar">Logscale Z:				
							<input ID="zlog" type="checkbox" name="zlog" class="var zvar log">
						</label>

						<label ID="zbounds_label" class="zvar">Z-axis Limits:					
							<input ID="zbounds" type="text" name="zbounds" class="var zvar bounds">
						</label>

					</div>

					

					<br>
					<div ID="plotholder" class="plot_container">
						<button ID="previous_button"> Previous </button>
						<button ID="next_button"> Next </button>
						
						<figure ID="plotfig">
							<img ID="plotimg" alt="My MSIS plot" src="" width:"750px" title="Click to show/hide plot details"></img>
						</figure>
						<div ID="capdiv" class="panel">
							<strong ID="caplabel">Plot Details (click to hide/show)</strong>
							<figcaption ID="plotimg_cap" class="plot_cap"></figcaption>
						</div>
						
					</div>
				</div>
			</div>	
		</div>
		
 	</body>
	</html>